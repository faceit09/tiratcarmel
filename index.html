<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>בתי כנסת בטירת הכרמל</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>body { font-family: 'Heebo', sans-serif; }</style>
</head>
<body class="bg-slate-100 text-slate-800">
    <header class="bg-blue-900 text-white p-6 shadow-xl text-center">
        <h1 class="text-3xl font-bold">בתי כנסת בטירת הכרמל</h1>
        <div id="header-zmanim" class="mt-4 flex justify-center gap-6 text-sm text-blue-200">טוען זמני יום...</div>
    </header>

    <main class="container mx-auto p-4">
        <div id="prayers-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
            <div class="col-span-full text-center py-10">מתחבר לנתונים...</div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyArvTHLvtHZwguLn0OpPMMJdqDKS7OnDOg",
            authDomain: "tirat-carmel-shul.firebaseapp.com",
            databaseURL: "https://tirat-carmel-shul-default-rtdb.firebaseio.com",
            projectId: "tirat-carmel-shul",
            storageBucket: "tirat-carmel-shul.firebasestorage.app",
            messagingSenderId: "645574971282",
            appId: "1:645574971282:web:9fb6720ea7c960ca37fb4b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let dailyTimes = {};

        async function fetchZmanim() {
            const res = await fetch('https://www.hebcal.com/zmanim?cfg=json&latitude=32.7599&longitude=34.9707&tzid=Asia/Jerusalem');
            const data = await res.json();
            dailyTimes.sunset = data.times.sunset;
            const sunsetStr = new Date(data.times.sunset).toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('header-zmanim').innerHTML = `שקיעה היום: <b>${sunsetStr}</b>`;
            loadData();
        }

        function calculateTime(raw) {
            if(!raw || !dailyTimes.sunset) return raw;
            if(raw.includes("לפני שקיעה")) {
                const mins = parseInt(raw);
                const date = new Date(dailyTimes.sunset);
                date.setMinutes(date.getMinutes() - mins);
                return date.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});
            }
            return raw;
        }

        function loadData() {
            onValue(ref(db, 'prayers'), (snap) => {
                const grid = document.getElementById('prayers-grid');
                grid.innerHTML = "";
                if(!snap.val()) return;
                Object.values(snap.val()).forEach(shul => {
                    grid.innerHTML += `
                        <div class="bg-white rounded-xl shadow p-5 border-t-4 border-blue-600">
                            <h3 class="text-xl font-bold text-blue-900">${shul.name} ${shul.nickname ? '<small class="text-gray-400">('+shul.nickname+')</small>' : ''}</h3>
                            <div class="grid grid-cols-2 gap-2 mt-4 text-sm">
                                <div class="bg-gray-50 p-2 rounded">
                                    <b class="block border-b mb-1">חול</b>
                                    שחרית: ${shul.shacharit_chol || '-'}<br>
                                    מנחה: ${calculateTime(shul.mincha_chol)}<br>
                                    ערבית: ${shul.arvit_chol || '-'}
                                </div>
                                <div class="bg-blue-50 p-2 rounded">
                                    <b class="block border-b border-blue-200 mb-1">שבת</b>
                                    שחרית: ${shul.shacharit_shabbat || '-'}<br>
                                    מנחה: ${calculateTime(shul.mincha_shabbat)}<br>
                                    ערבית: ${shul.arvit_shabbat || '-'}
                                </div>
                            </div>
                        </div>`;
                });
            });
        }
        fetchZmanim();
    </script>
</body>
</html>